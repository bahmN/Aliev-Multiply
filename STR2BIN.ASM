; ????????? ?????????????? ?????? ???????? ? ???????? ?????.
; ???? - ds:bx   - ????? ??????
; ????? - ax - ????? ?? ??????
;
str2bin  proc
    push bx
    push cx
    sub ax,ax        ; ???????? ax
    sub ch,ch        ; ???????? ch
        mov cl,byte ptr [bx]  ; ??????? ???????? - ? CX
blanks: cmp byte ptr[bx+1],' '   ;???? ???????? ????????
        jne chk_neg
        inc bx
        loop blanks
        jmp  good        ; ?? ?????????? ?????. ????????? - 0
;
; ????????? ??????? ??????????? ? ?????? ?????  "-"
;
chk_neg: cmp byte ptr [bx+1],'-'
    jne chk_pos
    inc bx               ; ?????????? ?????????
    dec cx               ; ????????? ???????
    call conv_ab         ; ??????? ????????? ??????????????
        jc thru              ;
    cmp ax,32768         ; ????? < -32768
    ja  no_good          ; ??, ??????
        neg ax               ; ???????? ???? ?????
        js  good             ; o'key , ???????
;
; ????????? ??????? ??????????? ? ??????, ???? ???? ?? ?????
;
chk_pos: cmp byte ptr [bx+1],'+'   ; sign '+' ?
        jne go_conv           ; ??? , ???? ?? ??????????????
        inc bx                ; ???????? ????????? ? ??????
        dec cx                ; ????????? ??????? ????????
go_conv: call conv_ab         ; ????????????? ?????? ? ?????
        jc thru               ; ? ?????? ?????? - ?? ?????
        cmp ax,32767          ; ????? ?? ??????? ?????? ?
        ja no_good            ; ??????? ??????, ??????
good:   clc                   ; ???????? ???? CY
        jnc thru              
no_good: stc                  ; set carry flag
thru:   pop cx                ; ???????????? ???????? ?????????
    pop bx
    jmp skipit
;
; ????????? ?????????? ?????????????? ?????
;
conv_ab proc
    push bp
    push bx
    push si
    mov  bp,bx      ; ????????? ????????? ?? ?????? ? bp
        sub  bx,bx      ; ???????? bx
range:  cmp byte ptr ds:[bp+1],'0'  ; ?????? - ????? ?
        jb  non_dig                 ; ??? ?? ?????
        cmp byte ptr ds:[bp+1],'9'  ; ?????? > '9'
        jbe digit                   ; ?????? - ?????
non_dig: stc                        ; ?????????? ???? ??????
        jc end_conv                 ; ? ????? ?? ?????????
digit:  mov si,10
    push dx                     ; ????????? dx
        mul si                      ; (ax)*(si)->(dx;ax)
        pop dx                      ; ???????????? dx
        mov bl,ds:[bp+1]            ; ????? ????????? ?????? ?? ??????
        and bx,0fh                  ; ????????????? ?????? ? ????????
        add ax,bx                   ; ???????? ?????? ? ??????? ??????????
        jc  end_conv                ; ???? ????????? ??????? ?????,?? ?????
        inc bp                      ; ????? ???? ????? ? ??????
        loop range                  ; ???????? ???? ?? ?????????? ????????
        clc                         ; ???????? ???? ????????(??? ??????)
end_conv:  pop si                    ; ???????????? ???????? ? ?????
         pop bx
         pop bp
         ret
conv_ab  endp

skipit:
   ret

str2bin  endp
